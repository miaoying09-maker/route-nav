<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å•ç‚¹å¯¼èˆªï¼ˆçº¯åˆ—è¡¨æœ€ç»ˆç‰ˆ + OCRï¼‰</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI";background:#f6f7f9;margin:0}
.wrap{max-width:820px;margin:auto;padding:12px}
h2{font-size:26px}
textarea{width:100%;height:140px;border-radius:14px;border:1px solid #ddd;padding:12px}
button{border:0;border-radius:14px;padding:12px 16px;font-size:16px;font-weight:800;margin:6px}
.primary{background:#1a73e8;color:#fff}
.ghost{background:#fff;border:1px solid #ddd}
.card{background:#fff;border-radius:18px;padding:14px;margin-top:10px;display:flex;justify-content:space-between;align-items:center}
.no{background:#000;color:#fff;border-radius:12px;padding:10px 14px;font-weight:900}
.addr{font-weight:800}
</style>
</head>

<body>
<div class="wrap">
<h2>å•ç‚¹å¯¼èˆªï¼ˆA æ–¹æ¡ˆ Â· ç¨³å®šç‰ˆï¼‰</h2>

<textarea id="input" placeholder="è¿™é‡Œä¼šè‡ªåŠ¨å¡«å…… OCR ç»“æœï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ç²˜è´´"></textarea>

<br>
<input type="file" id="imgs" accept="image/*" multiple>

<br>
<button class="primary" onclick="runOCR()">ğŸ“· è¯†åˆ«æˆªå›¾ï¼ˆæœ€å¤š 9 å¼ ï¼‰</button>
<button class="ghost" onclick="build()">ç”Ÿæˆåˆ—è¡¨</button>
<button class="ghost" onclick="copy()">å¤åˆ¶ï¼ˆå¸¦çº¿è·¯å·ï¼‰</button>

<div id="list"></div>
</div>

<script>
let orders=[];

async function runOCR(){
  const files=[...document.getElementById('imgs').files].slice(0,9);
  let allText="";
  for(const f of files){
    const r=await Tesseract.recognize(f,'eng');
    allText+=r.data.text+"\n";
  }
  document.getElementById('input').value=allText;
}

function build(){
  orders=[];
  const lines=document.getElementById('input').value.split('\n');

  let currentNo=null;

  for(const l of lines){
    // çº¿è·¯å·ï¼š1â€“4 ä½ï¼Œä¼˜å…ˆå–å¤§çš„
    const nums=[...l.matchAll(/(?<!\d)(\d{1,4})(?!\d)/g)]
      .map(x=>parseInt(x[1])).filter(n=>n<10000);
    if(nums.length) currentNo=Math.max(...nums);

    // åœ°å€
    if(/(St|Street|Ave|Avenue|Rd|Road|Blvd|Dr|Way|Pl|Ct).*(Pittsburgh|PA)/i.test(l)){
      orders.push({no:currentNo,addr:l.trim()});
    }
  }
  render();
}

function render(){
  const box=document.getElementById('list');
  box.innerHTML="";
  orders.sort((a,b)=>a.no-b.no);
  for(const o of orders){
    const d=document.createElement('div');
    d.className="card";
    d.innerHTML=`
      <div>
        <div class="no">NO.${o.no}</div>
        <div class="addr">${o.addr}</div>
      </div>
      <button class="primary" onclick="nav('${o.addr.replace(/'/g,'')}')">å¯¼èˆª</button>
    `;
    box.appendChild(d);
  }
}

function nav(addr){
  location.href="https://www.google.com/maps/dir/?api=1&destination="+encodeURIComponent(addr);
}

function copy(){
  const t=orders.map(o=>`${o.no} ${o.addr}`).join('\n');
  navigator.clipboard.writeText(t);
  alert("å·²å¤åˆ¶");
}
</script>
</body>
</html>
